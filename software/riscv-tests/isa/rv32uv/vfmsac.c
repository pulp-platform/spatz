// Copyright 2021 ETH Zurich and University of Bologna.
// Solderpad Hardware License, Version 0.51, see LICENSE for details.
// SPDX-License-Identifier: SHL-0.51
//
// Author: Matteo Perotti <mperotti@iis.ee.ethz.ch>
//         Basile Bougenot <bbougenot@student.ethz.ch>

#include "float_macros.h"
#include "vector_macros.h"

// Simple random test with similar values
void TEST_CASE1(void) {
  VSET(16, e16, m2);
  //               0.9175,  0.0740, -0.0362,  0.2961,  0.6226, -0.8032,  0.7749,
  //               0.8188,  0.2019,  0.4885,  0.5669, -0.1743,  0.4404,  0.0618,
  //               0.8252, -0.5947
  VLOAD_16(v4, 0x3b57, 0x2cbc, 0xa8a3, 0x34bd, 0x38fb, 0xba6d, 0x3a33, 0x3a8d,
           0x3276, 0x37d1, 0x3889, 0xb194, 0x370c, 0x2bea, 0x3a9a, 0xb8c2);
  //               0.2812, -0.6733,  0.3289,  0.9609, -0.6841,  0.5488, -0.1401,
  //               0.5591,  0.2759, -0.6973,  0.1418,  0.2389, -0.3308,  0.8867,
  //               0.8936,  0.3611
  VLOAD_16(v6, 0x3480, 0xb963, 0x3543, 0x3bb0, 0xb979, 0x3864, 0xb07c, 0x3879,
           0x346a, 0xb994, 0x308a, 0x33a5, 0xb54b, 0x3b18, 0x3b26, 0x35c7);
  //               0.4780, -0.1810,  0.2800,  0.7529,  0.6484, -0.9526,
  //               0.5947,  1.0000, -0.1874,  0.2949, -0.4280,  0.6934,  0.5444,
  //               0.8823, -0.8911,  0.7603
  VLOAD_16(v2, 0x37a6, 0xb1cb, 0x347b, 0x3a06, 0x3930, 0xbb9f, 0x38c2, 0x3c00,
           0xb1ff, 0x34b8, 0xb6d9, 0x398c, 0x385b, 0x3b0f, 0xbb21, 0x3a15);
  asm volatile("vfmsac.vv v2, v4, v6");
  //              -0.2200,  0.1312, -0.2920, -0.4683, -1.0742,  0.5117, -0.7031,
  //              -0.5420,  0.2430, -0.6357,  0.5083, -0.7349, -0.6904, -0.8276,
  //              1.6289, -0.9751
  VCMP_U16(1, v2, 0xb30a, 0x3033, 0xb4ac, 0xb77e, 0xbc4c, 0x3818, 0xb9a0,
           0xb856, 0x33c7, 0xb916, 0x3811, 0xb9e1, 0xb985, 0xba9f, 0x3e84,
           0xbbcd);

  VSET(16, e32, m2);
  //              -0.90310860,  0.30282700,  0.54854167, -0.38732994,
  //              0.92121714,  0.99595129, -0.10263380,  0.83759040,
  //              -0.23468767,  0.03914077, -0.46234205,  0.38326120,
  //              0.36417511, -0.50103557,  0.36991179,  0.44718841
  VLOAD_32(v4, 0xbf673220, 0x3e9b0c24, 0x3f0c6d3a, 0xbec6501c, 0x3f6bd4e3,
           0x3f7ef6aa, 0xbdd231ab, 0x3f566c53, 0xbe7051f7, 0x3d205212,
           0xbeecb819, 0x3ec43ad0, 0x3eba7529, 0xbf0043de, 0x3ebd6514,
           0x3ee4f5e1);
  //               0.84989786, -0.04543342, -0.74596256, -0.30687407,
  //               -0.30795863,  0.57084304,  0.51653886, -0.97366458,
  //               0.49300706,  0.62932760,  0.45846274, -0.73850167,
  //               -0.42686453, -0.31419462, -0.47245970, -0.87721694
  VLOAD_32(v6, 0x3f5992e8, 0xbd3a1866, 0xbf3ef767, 0xbe9d1e99, 0xbe9dacc1,
           0x3f1222c5, 0x3f043be4, 0xbf794215, 0x3efc6b6c, 0x3f211b9d,
           0x3eeabba1, 0xbf3d0e72, 0xbeda8dfd, 0xbea0de1e, 0xbef1e63d,
           0xbf60914a);
  //              -0.76813585,  0.87161541, -0.67958647, -0.98584491,
  //              0.12284227, -0.04006640, -0.93113720, -0.93526161,
  //              -0.27461481,  0.64110506,  0.61687475, -0.43741968,
  //              0.70502371,  0.37014356, -0.98105848,  0.77993429
  VLOAD_32(v2, 0xbf44a48d, 0x3f5f2230, 0xbf2df961, 0xbf7c6055, 0x3dfb94bb,
           0xbd241caa, 0xbf6e5f02, 0xbf6f6d4e, 0xbe8c9a50, 0x3f241f76,
           0x3f1deb81, 0xbedff579, 0x3f347c6f, 0x3ebd8375, 0xbf7b26a6,
           0x3f47a9c6);
  asm volatile("vfmsac.vv v2, v4, v6");
  //               0.00058579, -0.88537389,  0.27039492,  1.10470641,
  //               -0.40653905,  0.60859829,  0.87812287,  0.11972952,
  //               0.15891212, -0.61647266, -0.82884133,  0.15438065,
  //               -0.86047715, -0.21272089,  0.80629003, -1.17221546
  VCMP_U32(2, v2, 0x3a198f11, 0xbf62a7dd, 0x3e8a7134, 0x3f8d6705, 0xbed025e3,
           0x3f1bcd19, 0x3f60cca9, 0x3df534be, 0x3e22b9dd, 0xbf1dd127,
           0xbf542ef3, 0x3e1e15f6, 0xbf5c483b, 0xbe59d381, 0x3f4e6907,
           0xbf960b29);
};

// Simple random test with similar values (masked)
// The numbers are the same of TEST_CASE1
void TEST_CASE2(void) {
  VSET(16, e16, m2);
  //               0.9175,  0.0740, -0.0362,  0.2961,  0.6226, -0.8032,  0.7749,
  //               0.8188,  0.2019,  0.4885,  0.5669, -0.1743,  0.4404,  0.0618,
  //               0.8252, -0.5947
  VLOAD_16(v4, 0x3b57, 0x2cbc, 0xa8a3, 0x34bd, 0x38fb, 0xba6d, 0x3a33, 0x3a8d,
           0x3276, 0x37d1, 0x3889, 0xb194, 0x370c, 0x2bea, 0x3a9a, 0xb8c2);
  //               0.2812, -0.6733,  0.3289,  0.9609, -0.6841,  0.5488, -0.1401,
  //               0.5591,  0.2759, -0.6973,  0.1418,  0.2389, -0.3308,  0.8867,
  //               0.8936,  0.3611
  VLOAD_16(v6, 0x3480, 0xb963, 0x3543, 0x3bb0, 0xb979, 0x3864, 0xb07c, 0x3879,
           0x346a, 0xb994, 0x308a, 0x33a5, 0xb54b, 0x3b18, 0x3b26, 0x35c7);
  VLOAD_8(v0, 0xAA, 0xAA);
  //               0.4780, -0.1810,  0.2800,  0.7529,  0.6484, -0.9526,
  //               0.5947,  1.0000, -0.1874,  0.2949, -0.4280,  0.6934,  0.5444,
  //               0.8823, -0.8911,  0.7603
  VLOAD_16(v2, 0x37a6, 0xb1cb, 0x347b, 0x3a06, 0x3930, 0xbb9f, 0x38c2, 0x3c00,
           0xb1ff, 0x34b8, 0xb6d9, 0x398c, 0x385b, 0x3b0f, 0xbb21, 0x3a15);
  asm volatile("vfmsac.vv v2, v4, v6, v0.t");
  //               0.4780,  0.1312,  0.2800, -0.4683,  0.6484,  0.5117,  0.5947,
  //               -0.5420, -0.1874, -0.6357, -0.4280, -0.7349,  0.5444,
  //               -0.8276, -0.8911, -0.9751
  VCMP_U16(3, v2, 0x37a6, 0x3033, 0x347b, 0xb77e, 0x3930, 0x3818, 0x38c2,
           0xb856, 0xb1ff, 0xb916, 0xb6d9, 0xb9e1, 0x385b, 0xba9f, 0xbb21,
           0xbbcd);

  VSET(16, e32, m2);
  //              -0.90310860,  0.30282700,  0.54854167, -0.38732994,
  //              0.92121714,  0.99595129, -0.10263380,  0.83759040,
  //              -0.23468767,  0.03914077, -0.46234205,  0.38326120,
  //              0.36417511, -0.50103557,  0.36991179,  0.44718841
  VLOAD_32(v4, 0xbf673220, 0x3e9b0c24, 0x3f0c6d3a, 0xbec6501c, 0x3f6bd4e3,
           0x3f7ef6aa, 0xbdd231ab, 0x3f566c53, 0xbe7051f7, 0x3d205212,
           0xbeecb819, 0x3ec43ad0, 0x3eba7529, 0xbf0043de, 0x3ebd6514,
           0x3ee4f5e1);
  //               0.84989786, -0.04543342, -0.74596256, -0.30687407,
  //               -0.30795863,  0.57084304,  0.51653886, -0.97366458,
  //               0.49300706,  0.62932760,  0.45846274, -0.73850167,
  //               -0.42686453, -0.31419462, -0.47245970, -0.87721694
  VLOAD_32(v6, 0x3f5992e8, 0xbd3a1866, 0xbf3ef767, 0xbe9d1e99, 0xbe9dacc1,
           0x3f1222c5, 0x3f043be4, 0xbf794215, 0x3efc6b6c, 0x3f211b9d,
           0x3eeabba1, 0xbf3d0e72, 0xbeda8dfd, 0xbea0de1e, 0xbef1e63d,
           0xbf60914a);
  VLOAD_8(v0, 0xAA, 0xAA);
  //              -0.76813585,  0.87161541, -0.67958647, -0.98584491,
  //              0.12284227, -0.04006640, -0.93113720, -0.93526161,
  //              -0.27461481,  0.64110506,  0.61687475, -0.43741968,
  //              0.70502371,  0.37014356, -0.98105848,  0.77993429
  VLOAD_32(v2, 0xbf44a48d, 0x3f5f2230, 0xbf2df961, 0xbf7c6055, 0x3dfb94bb,
           0xbd241caa, 0xbf6e5f02, 0xbf6f6d4e, 0xbe8c9a50, 0x3f241f76,
           0x3f1deb81, 0xbedff579, 0x3f347c6f, 0x3ebd8375, 0xbf7b26a6,
           0x3f47a9c6);
  asm volatile("vfmsac.vv v2, v4, v6, v0.t");
  //              -0.76813585, -0.88537389, -0.67958647,  1.10470641,
  //              0.12284227,  0.60859829, -0.93113720,  0.11972952,
  //              -0.27461481, -0.61647266,  0.61687475,  0.15438065,
  //              0.70502371, -0.21272089, -0.98105848, -1.17221546
  VCMP_U32(4, v2, 0xbf44a48d, 0xbf62a7dd, 0xbf2df961, 0x3f8d6705, 0x3dfb94bb,
           0x3f1bcd19, 0xbf6e5f02, 0x3df534be, 0xbe8c9a50, 0xbf1dd127,
           0x3f1deb81, 0x3e1e15f6, 0x3f347c6f, 0xbe59d381, 0xbf7b26a6,
           0xbf960b29);
};

// Simple random test with similar values (vector-scalar)
void TEST_CASE3(void) {
  VSET(16, e16, m2);
  float fscalar_16;
  //                              0.3911
  BOX_HALF_IN_FLOAT(fscalar_16, 0x3642);
  //               0.3203, -0.8521,  0.0744,  0.9370,  0.2056,  0.2866, -0.8379,
  //               -0.2668, -0.0878, -0.5703,  0.1272, -0.6606, -0.6919, 0.9189,
  //               0.6245,  0.9932
  VLOAD_16(v4, 0x3520, 0xbad1, 0x2cc3, 0x3b7f, 0x3294, 0x3496, 0xbab4, 0xb445,
           0xad9f, 0xb890, 0x3012, 0xb949, 0xb989, 0x3b5a, 0x38ff, 0x3bf2);
  //               0.8706,  0.4900, -0.9497,  0.4727, -0.7168,  0.0167, -0.3606,
  //               -0.1565, -0.5142,  0.8271, -0.4783,  0.6318,  0.0842,
  //               -0.6646,  0.1454, -0.3020
  VLOAD_16(v2, 0x3af7, 0x37d7, 0xbb99, 0x3790, 0xb9bc, 0x2445, 0xb5c5, 0xb102,
           0xb81d, 0x3a9e, 0xb7a7, 0x390e, 0x2d63, 0xb951, 0x30a7, 0xb4d5);
  asm volatile("vfmsac.vf v2, %[A], v4" ::[A] "f"(fscalar_16));
  //              -0.7451, -0.8232,  0.9790, -0.1062,  0.7974,  0.0955,  0.0330,
  //              0.0521,  0.4797, -1.0498,  0.5278, -0.8901, -0.3547,  1.0234,
  //              0.0989,  0.6904
  VCMP_U16(5, v2, 0xb9f6, 0xba96, 0x3bd5, 0xaecc, 0x3a61, 0x2e1b, 0x2836,
           0x2aac, 0x37ad, 0xbc33, 0x3839, 0xbb1f, 0xb5ad, 0x3c19, 0x2e54,
           0x3986);

  VSET(16, e32, m2);
  float fscalar_32;
  //                              -0.39704049
  BOX_FLOAT_IN_FLOAT(fscalar_32, 0xbecb48e4);
  //               0.43844241,  0.13734208,  0.15601240,  0.48965997,
  //               -0.41457745, -0.69918746,  0.38535324,  0.83301985,
  //               0.79336989, -0.03326649, -0.85931808,  0.92554229,
  //               -0.77742523,  0.47821125, -0.53653014, -0.32442030
  VLOAD_32(v4, 0x3ee07b86, 0x3e0ca367, 0x3e1fc1b7, 0x3efab4b6, 0xbed4437f,
           0xbf32fdf3, 0x3ec54d05, 0x3f5540ca, 0x3f4b1a4a, 0xbd084272,
           0xbf5bfc45, 0x3f6cf057, 0xbf470557, 0x3ef4d81b, 0xbf095a0a,
           0xbea61a6b);
  //              -0.73119336,  0.87333083, -0.16325396, -0.30275631,
  //              0.34779423,  0.22721651,  0.47497734, -0.58483958,
  //              -0.24916913,  0.13750601, -0.99799657,  0.66137350,
  //              0.58565408,  0.68887448, -0.74538875,  0.99311894
  VLOAD_32(v2, 0xbf3b2f7d, 0x3f5f929c, 0xbe272c0c, 0xbe9b02e0, 0x3eb21216,
           0x3e68ab72, 0x3ef3303b, 0xbf15b80c, 0xbe7f2631, 0x3e0cce60,
           0xbf7f7cb4, 0x3f294fc6, 0x3f15ed6d, 0x3f305a14, 0xbf3ed1cc,
           0x3f7e3d0b);
  asm volatile("vfmsac.vf v2, %[A], v4" ::[A] "f"(fscalar_32));
  //               0.55711401, -0.92786121,  0.10131072,  0.10834149,
  //               -0.18319020,  0.05038923, -0.62797821,  0.25409698,
  //               -0.06583084, -0.12429786,  1.33918071, -1.02885127,
  //               -0.27698478, -0.87874371,  0.95841295, -0.86431098
  VCMP_U32(6, v2, 0x3f0e9f06, 0xbf6d8850, 0x3dcf7bff, 0x3ddde223, 0xbe3b9636,
           0x3d4e64ec, 0xbf20c32e, 0x3e821900, 0xbd86d252, 0xbdfe8fe1,
           0x3fab6a45, 0xbf83b166, 0xbe8dd0f3, 0xbf60f559, 0x3f755a8d,
           0xbf5d437b);
};

// Simple random test with similar values (vector-scalar) (masked)
void TEST_CASE4(void) {
  VSET(16, e16, m2);
  float fscalar_16;
  //                              0.3911
  BOX_HALF_IN_FLOAT(fscalar_16, 0x3642);
  //                0.3203, -0.8521,  0.0744,  0.9370,  0.2056,  0.2866,
  //                -0.8379, -0.2668, -0.0878, -0.5703,  0.1272, -0.6606,
  //                -0.6919,  0.9189,  0.6245,  0.9932
  VLOAD_16(v4, 0x3520, 0xbad1, 0x2cc3, 0x3b7f, 0x3294, 0x3496, 0xbab4, 0xb445,
           0xad9f, 0xb890, 0x3012, 0xb949, 0xb989, 0x3b5a, 0x38ff, 0x3bf2);
  VLOAD_8(v0, 0xAA, 0xAA);
  //                0.8706,  0.4900, -0.9497,  0.4727, -0.7168,  0.0167,
  //                -0.3606, -0.1565, -0.5142,  0.8271, -0.4783,  0.6318,
  //                0.0842, -0.6646,  0.1454, -0.3020
  VLOAD_16(v2, 0x3af7, 0x37d7, 0xbb99, 0x3790, 0xb9bc, 0x2445, 0xb5c5, 0xb102,
           0xb81d, 0x3a9e, 0xb7a7, 0x390e, 0x2d63, 0xb951, 0x30a7, 0xb4d5);
  asm volatile("vfmsac.vf v2, %[A], v4, v0.t" ::[A] "f"(fscalar_16));
  //                0.8706, -0.8232, -0.9497, -0.1062, -0.7168,  0.0955,
  //                -0.3606,  0.0521, -0.5142, -1.0498, -0.4783, -0.8901,
  //                0.0842,  1.0234,  0.1454,  0.6904
  VCMP_U16(7, v2, 0x3af7, 0xba96, 0xbb99, 0xaecc, 0xb9bc, 0x2e1b, 0xb5c5,
           0x2aac, 0xb81d, 0xbc33, 0xb7a7, 0xbb1f, 0x2d63, 0x3c19, 0x30a7,
           0x3986);

  VSET(16, e32, m2);
  float fscalar_32;
  //                              -0.39704049
  BOX_FLOAT_IN_FLOAT(fscalar_32, 0xbecb48e4);
  //                0.43844241,  0.13734208,  0.15601240,  0.48965997,
  //                -0.41457745, -0.69918746,  0.38535324,  0.83301985,
  //                0.79336989, -0.03326649, -0.85931808,  0.92554229,
  //                -0.77742523,  0.47821125, -0.53653014, -0.32442030
  VLOAD_32(v4, 0x3ee07b86, 0x3e0ca367, 0x3e1fc1b7, 0x3efab4b6, 0xbed4437f,
           0xbf32fdf3, 0x3ec54d05, 0x3f5540ca, 0x3f4b1a4a, 0xbd084272,
           0xbf5bfc45, 0x3f6cf057, 0xbf470557, 0x3ef4d81b, 0xbf095a0a,
           0xbea61a6b);
  VLOAD_8(v0, 0xAA, 0xAA);
  //               -0.73119336,  0.87333083, -0.16325396, -0.30275631,
  //               0.34779423,  0.22721651,  0.47497734, -0.58483958,
  //               -0.24916913,  0.13750601, -0.99799657,  0.66137350,
  //               0.58565408,  0.68887448, -0.74538875,  0.99311894
  VLOAD_32(v2, 0xbf3b2f7d, 0x3f5f929c, 0xbe272c0c, 0xbe9b02e0, 0x3eb21216,
           0x3e68ab72, 0x3ef3303b, 0xbf15b80c, 0xbe7f2631, 0x3e0cce60,
           0xbf7f7cb4, 0x3f294fc6, 0x3f15ed6d, 0x3f305a14, 0xbf3ed1cc,
           0x3f7e3d0b);
  asm volatile("vfmsac.vf v2, %[A], v4, v0.t" ::[A] "f"(fscalar_32));
  //               -0.73119336, -0.92786121, -0.16325396,  0.10834149,
  //               0.34779423,  0.05038923,  0.47497734,  0.25409698,
  //               -0.24916913, -0.12429786, -0.99799657, -1.02885127,
  //               0.58565408, -0.87874371, -0.74538875, -0.86431098
  VCMP_U32(8, v2, 0xbf3b2f7d, 0xbf6d8850, 0xbe272c0c, 0x3ddde223, 0x3eb21216,
           0x3d4e64ec, 0x3ef3303b, 0x3e821900, 0xbe7f2631, 0xbdfe8fe1,
           0xbf7f7cb4, 0xbf83b166, 0x3f15ed6d, 0xbf60f559, 0xbf3ed1cc,
           0xbf5d437b);
};

int main(void) {
  INIT_CHECK();
  enable_vec();
  enable_fp();

  TEST_CASE1();
  //TEST_CASE2();
  TEST_CASE3();
  //TEST_CASE4();

  EXIT_CHECK();
}
